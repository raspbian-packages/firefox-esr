From: Mike Hommey <mh@glandium.org>
Date: Sat, 5 Dec 2015 18:23:58 +0900
Subject: Allow unsigned addons in /usr/{lib,share}/mozilla/extensions

---
 toolkit/mozapps/extensions/content/extensions.js    | 2 ++
 toolkit/mozapps/extensions/internal/XPIProvider.jsm | 3 ++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/toolkit/mozapps/extensions/content/extensions.js b/toolkit/mozapps/extensions/content/extensions.js
index 532dca6..83d4407 100644
--- a/toolkit/mozapps/extensions/content/extensions.js
+++ b/toolkit/mozapps/extensions/content/extensions.js
@@ -202,6 +202,8 @@ function loadView(aViewId) {
 }
 
 function isCorrectlySigned(aAddon) {
+  if (aAddon.scope == AddonManager.SCOPE_SYSTEM)
+    return true;
   if (aAddon.signedState <= AddonManager.SIGNEDSTATE_MISSING)
     return false;
   if (aAddon.foreignInstall && aAddon.signedState < AddonManager.SIGNEDSTATE_SIGNED)
diff --git a/toolkit/mozapps/extensions/internal/XPIProvider.jsm b/toolkit/mozapps/extensions/internal/XPIProvider.jsm
index ac14ea3..2b4b5d5 100644
--- a/toolkit/mozapps/extensions/internal/XPIProvider.jsm
+++ b/toolkit/mozapps/extensions/internal/XPIProvider.jsm
@@ -666,7 +666,8 @@ function isUsableAddon(aAddon) {
     return false;
   }
 
-  if (aAddon._installLocation.name != KEY_APP_SYSTEM_DEFAULTS && mustSign(aAddon.type)) {
+  if (aAddon._installLocation.scope != AddonManager.SCOPE_SYSTEM &&
+      aAddon._installLocation.name != KEY_APP_SYSTEM_DEFAULTS && mustSign(aAddon.type)) {
     if (aAddon.signedState <= AddonManager.SIGNEDSTATE_MISSING)
       return false;
     if (aAddon.foreignInstall && aAddon.signedState < AddonManager.SIGNEDSTATE_SIGNED)
